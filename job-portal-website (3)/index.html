<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Job Portal — Dashboard, AI Tools, eBooks</title>
    <meta name="description" content="Modern job portal with dashboard, prompt engineering AI tools, and eBooks. All in HTML, CSS, and JS." />
    <style>
      :root {
        --brand: #2563eb;       /* Primary */
        --accent: #22d3ee;      /* Accent */
        --bg: #ffffff;          /* Neutral */
        --muted: #f3f4f6;       /* Neutral */
        --fg: #0b1220;          /* Neutral (dark foreground) */
        --radius: 12px;
        --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
        --shadow-md: 0 6px 16px rgba(2,6,23,.08);
        --ring: 0 0 0 3px rgba(34,211,238,.3);
      }
      html[data-theme="dark"] {
        --bg: #0b1220;
        --muted: #111827;
        --fg: #f3f4f6;
        --shadow-sm: 0 1px 2px rgba(255,255,255,.05);
        --shadow-md: 0 6px 16px rgba(255,255,255,.06);
        --ring: 0 0 0 3px rgba(37,99,235,.35);
      }
      * { box-sizing: border-box }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.55;
      }
      a { color: var(--brand); text-decoration: none }
      a:hover { text-decoration: underline }
      img { max-width: 100%; height: auto }
      button, input, select, textarea {
        font: inherit;
        color: inherit;
      }

      /* Layout */
      .container { max-width: 1200px; margin: 0 auto; padding: 0 16px }
      header {
        position: sticky; top: 0; z-index: 50;
        background: var(--bg);
        border-bottom: 1px solid rgba(2,6,23,.08);
        backdrop-filter: saturate(140%) blur(6px);
      }
      .nav {
        display: flex; align-items: center; justify-content: space-between;
        gap: 12px; padding: 12px 0;
      }
      .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; }
      .brand-mark {
        width: 28px; height: 28px; border-radius: 8px;
        background: var(--brand);
        box-shadow: inset 0 -6px 12px rgba(0,0,0,.12);
      }
      .tabs {
        display: none; gap: 8px; flex-wrap: wrap; align-items: center;
      }
      .tabs button {
        border: 1px solid rgba(2,6,23,.12);
        background: var(--bg); color: var(--fg);
        border-radius: 999px; padding: 8px 14px; cursor: pointer;
      }
      .tabs button[aria-selected="true"] {
        background: var(--brand); color: #fff; border-color: var(--brand);
      }

      .actions {
        display: flex; align-items: center; gap: 8px;
      }
      .icon-btn {
        border: 1px solid rgba(2,6,23,.12);
        background: var(--bg); color: var(--fg);
        border-radius: 999px; padding: 8px 10px; cursor: pointer;
        display: inline-flex; align-items: center; gap: 8px;
      }
      .badge {
        display: inline-block; min-width: 20px; height: 20px; padding: 0 6px;
        border-radius: 999px; background: var(--accent); color: #0b1220;
        font-size: 12px; font-weight: 700; line-height: 20px; text-align: center;
      }
      .searchbar {
        margin: 10px 0 16px; display: grid; grid-template-columns: 1fr;
        gap: 8px;
      }
      .searchbar input, .searchbar select {
        border: 1px solid rgba(2,6,23,.12);
        background: var(--bg); color: var(--fg);
        border-radius: 10px; padding: 10px 12px;
      }
      .grid { display: grid; gap: 16px }
      .grid-2 { grid-template-columns: 1fr }
      .grid-3 { grid-template-columns: 1fr }
      .card {
        border: 1px solid rgba(2,6,23,.08);
        background: var(--bg); border-radius: var(--radius);
        box-shadow: var(--shadow-sm); padding: 16px;
      }
      .kpi { display:flex; align-items: center; justify-content: space-between }
      .kpi strong { font-size: 22px }
      .muted { color: rgba(2,6,23,.6); }
      html[data-theme="dark"] .muted { color: rgba(243,244,246,.7) }

      /* Slider */
      .slider {
        position: relative; overflow: hidden; border-radius: var(--radius);
        background: var(--muted); border: 1px solid rgba(2,6,23,.08);
      }
      .slides {
        display: flex; transition: transform .6s ease;
      }
      .slide {
        min-width: 100%; padding: 14px 16px; display: flex; gap: 12px; align-items: center;
      }
      .slide .dot {
        width: 10px; height: 10px; border-radius: 999px; background: var(--brand);
      }

      /* Lists */
      .chip {
        display: inline-block; padding: 4px 10px; border-radius: 999px;
        background: var(--muted); border: 1px solid rgba(2,6,23,.08);
        margin: 2px; font-size: 12px;
      }

      .btn {
        border: 1px solid rgba(2,6,23,.12);
        background: var(--bg); color: var(--fg);
        border-radius: 10px; padding: 10px 12px; cursor: pointer;
      }
      .btn.brand { background: var(--brand); color: #fff; border-color: var(--brand) }
      .btn.accent { background: var(--accent); color: #0b1220; border-color: var(--accent) }
      .btn.ghost { background: transparent }
      .btn.full { width: 100% }

      .toolbar { display:flex; gap: 8px; flex-wrap: wrap }

      /* Forms */
      .form { display:grid; gap: 10px }
      .field { display:grid; gap: 6px }
      label { font-weight: 600 }
      input[type="date"], input[type="file"], textarea { 
        border: 1px solid rgba(2,6,23,.12);
        background: var(--bg); color: var(--fg);
        border-radius: 10px; padding: 10px 12px;
      }
      textarea { min-height: 120px; resize: vertical }

      /* Sections */
      main section { display: none }
      main section[aria-hidden="false"] { display: block }
      .section-header { display:flex; align-items:center; justify-content: space-between; gap: 12px; margin: 6px 0 12px }
      .h1 { font-size: 24px; font-weight: 800 }
      .h2 { font-size: 18px; font-weight: 700 }
      .sr-only { position:absolute; width:1px; height:1px; margin:-1px; padding:0; border:0; clip:rect(0 0 0 0); overflow:hidden }

      /* Reveal animation */
      .reveal { opacity: 0; transform: translateY(8px); transition: all .4s ease }
      .reveal.in { opacity: 1; transform: translateY(0) }

      /* Footer */
      footer { margin: 24px 0; padding: 16px 0; border-top: 1px solid rgba(2,6,23,.08); font-size: 14px }

      /* Responsive */
      @media (min-width: 768px) {
        .tabs { display: flex }
        .searchbar { grid-template-columns: 2fr 1fr 1fr 1fr 1fr }
        .grid-2 { grid-template-columns: repeat(2, 1fr) }
        .grid-3 { grid-template-columns: repeat(3, 1fr) }
      }
    </style>
  </head>
  <body>
    <header role="banner">
      <div class="container nav">
        <div class="brand">
          <span class="brand-badge" aria-hidden="true"></span>
          <span aria-label="Meechto Jobs">Meechto Jobs</span>
        </div>
        <nav aria-label="Primary">
          <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#search">Search Jobs</a></li>
            <li><a id="loginLink" href="login.html">Login</a></li>
            <li><a id="registerLink" href="register.html">Register</a></li>
            <li><button id="logoutBtn" class="toggle" style="display:none" type="button">Logout</button></li>
            <li>
              <button id="themeToggle" class="toggle" role="switch" aria-pressed="false" aria-label="Toggle theme">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path id="themeIcon" d="M12 4a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V5a1 1 0 0 1 1-1Zm7 7a1 1 0 0 1 1 1h1a1 1 0 1 1 0 2h-1a1 1 0 1 1-2 0 5 5 0 1 1-5-5 1 1 0 1 1 0-2 7 7 0 1 0 7 7Z"/>
                </svg>
                <span>Theme</span>
              </button>
            </li>
          </ul>
        </nav>
      </div>

      <div class="container">
        <div class="searchbar" role="search">
          <input id="q" type="search" placeholder="Search jobs by title or skills…" aria-label="Search jobs" />
          <input id="loc" type="text" placeholder="Location" aria-label="Filter by location" />
          <select id="type" aria-label="Filter by type">
            <option value="">Any Type</option>
            <option>Full-time</option>
            <option>Contract</option>
            <option>Internship</option>
          </select>
          <select id="salary" aria-label="Filter by salary">
            <option value="">Any Salary</option>
            <option value="0-20000">0 - 20,000</option>
            <option value="20000-40000">20,000 - 40,000</option>
            <option value="40000-80000">40,000 - 80,000</option>
            <option value="80000+">80,000+</option>
          </select>
          <button id="searchBtn" class="btn brand">Search</button>
        </div>
      </div>
    </header>

    <main class="container" id="app" tabindex="-1">
       Dashboard 
      <section id="dashboard" aria-hidden="false">
        <div class="section-header">
          <div class="h1">Dashboard</div>
          <div class="toolbar">
            <button id="seedBtn" class="btn">Reset & Seed Data</button>
          </div>
        </div>

        <div class="grid grid-3">
          <div class="card kpi reveal"><div class="h2">Open Jobs</div><strong id="kpiJobs">0</strong></div>
          <div class="card kpi reveal"><div class="h2">Applicants</div><strong id="kpiApps">0</strong></div>
          <div class="card kpi reveal"><div class="h2">Messages</div><strong id="kpiMsgs">0</strong></div>
        </div>

        <div class="card slider reveal" aria-label="Top job updates">
          <div id="slides" class="slides">
             Slides injected 
          </div>
        </div>

        <div class="grid grid-2" style="margin-top: 16px">
          <div class="card reveal">
            <div class="h2">Featured Companies</div>
            <div id="featuredCompanies" class="muted" style="margin-top:8px">No featured companies yet.</div>
          </div>
          <div class="card reveal">
            <div class="h2">Recent Activity</div>
            <div id="activity" class="muted" style="margin-top:8px">No activity yet.</div>
          </div>
        </div>
      </section>

       Jobs 
      <section id="jobs" aria-hidden="true">
        <div class="section-header">
          <div class="h1">Jobs</div>
          <div class="toolbar">
            <button class="btn" id="clearFiltersBtn">Clear Filters</button>
          </div>
        </div>
        <div id="jobList" class="grid grid-2">
           Jobs injected 
        </div>
      </section>

       Post Job 
      <section id="post" aria-hidden="true">
        <div class="section-header">
          <div class="h1">Post a Job</div>
          <div class="muted">For Contractors / Companies</div>
        </div>
        <form id="postForm" class="card form" aria-describedby="postHelp">
          <p id="postHelp" class="muted">
            Add a vacancy with title, role, skills, salary/stipend, facilities, and optional attachment. Expired jobs auto-remove.
          </p>
          <div class="grid grid-2">
            <div class="field">
              <label for="company">Company</label>
              <input id="company" required placeholder="e.g., Bhavani Industries" />
            </div>
            <div class="field">
              <label for="location">Location</label>
              <input id="location" required placeholder="e.g., Chakan, Pune" />
            </div>
          </div>

          <div class="grid grid-2">
            <div class="field">
              <label for="title">Job Title</label>
              <input id="title" required placeholder="e.g., ITI Fitter" />
            </div>
            <div class="field">
              <label for="role">Role</label>
              <input id="role" required placeholder="e.g., Welder / Purchase / Design" />
            </div>
          </div>

          <div class="grid grid-3">
            <div class="field">
              <label for="typeSel">Type</label>
              <select id="typeSel" required>
                <option>Full-time</option>
                <option>Contract</option>
                <option>Internship</option>
              </select>
            </div>
            <div class="field">
              <label for="salaryIn">Salary / Stipend (₹)</label>
              <input id="salaryIn" type="number" min="0" step="1000" placeholder="e.g., 25000" />
            </div>
            <div class="field">
              <label for="count">Vacancy Count</label>
              <input id="count" type="number" min="1" value="1" />
            </div>
          </div>

          <div class="field">
            <label for="skills">Skills (comma separated)</label>
            <input id="skills" placeholder="e.g., MIG welding, blueprint reading" />
          </div>

          <div class="field">
            <label for="desc">Job Description & Requirements</label>
            <textarea id="desc" placeholder="Responsibilities, requirements, etc."></textarea>
          </div>

          <div class="grid grid-3">
            <div class="field">
              <label>Facilities</label>
              <div>
                <label><input type="checkbox" value="Bus" /> Bus</label>
                <label style="margin-left:12px"><input type="checkbox" value="Canteen" /> Canteen</label>
                <label style="margin-left:12px"><input type="checkbox" value="Medical" /> Medical</label>
              </div>
            </div>
            <div class="field">
              <label for="expiry">Expiry Date</label>
              <input id="expiry" type="date" />
            </div>
            <div class="field">
              <label for="attach">Attach Document (optional)</label>
              <input id="attach" type="file" />
            </div>
          </div>

          <div class="toolbar">
            <button class="btn brand" type="submit">Publish Job</button>
            <button class="btn ghost" type="reset">Reset</button>
          </div>
        </form>
      </section>

       Applicants / Applied 
      <section id="apps" aria-hidden="true">
        <div class="section-header">
          <div class="h1">Applicants / Applied Jobs</div>
          <div class="muted">Contractors see applicants; Job seekers see their applications.</div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="h2">For Contractors: Applicants by Job</div>
            <div id="applicantsList" class="muted">No applicants yet.</div>
          </div>
          <div class="card">
            <div class="h2">For Job Seekers: Your Applications</div>
            <div id="appliedList" class="muted">No applications yet.</div>
          </div>
        </div>
      </section>

       Messages 
      <section id="messages" aria-hidden="true">
        <div class="section-header">
          <div class="h1">Messages</div>
          <div class="muted">In-portal communication between employees and contractors.</div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="h2">Conversations</div>
            <div id="conversations" class="muted">No conversations yet.</div>
          </div>
          <div class="card">
            <div class="h2">Thread</div>
            <div id="thread" class="muted">Select a conversation.</div>
            <form id="msgForm" class="form" style="margin-top:12px">
              <div class="field">
                <label for="msgText" class="sr-only">Message</label>
                <textarea id="msgText" placeholder="Type your message…"></textarea>
              </div>
              <div class="toolbar">
                <button class="btn brand" type="submit">Send</button>
                <button class="btn" type="button" id="shareContactBtn">Share Contact Details</button>
              </div>
            </form>
          </div>
        </div>
      </section>

       Admin 
      <section id="admin" aria-hidden="true">
        <div class="section-header">
          <div class="h1">Admin Dashboard</div>
          <div class="muted">Approve/reject vacancies, manage users, highlight companies.</div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="h2">Pending Vacancies</div>
            <div id="pendingJobs" class="muted">No pending vacancies.</div>
          </div>
          <div class="card">
            <div class="h2">Users</div>
            <div id="usersList" class="muted">No users.</div>
          </div>
        </div>
      </section>

       AI Tools 
      <section id="tools" aria-hidden="true">
        <div class="section-header">
          <div class="h1">AI Tools & Prompt Engineering</div>
          <div class="muted">Local, on-device helpers (no server). Use templates and keyword matching.</div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="h2">Job Description Generator (Prompt Template)</div>
            <div class="field">
              <label for="jdTitle">Title</label>
              <input id="jdTitle" placeholder="e.g., ITI Fitter" />
            </div>
            <div class="field">
              <label for="jdSkills">Key Skills (comma separated)</label>
              <input id="jdSkills" placeholder="e.g., MIG, TIG, blueprint reading" />
            </div>
            <div class="field">
              <label for="jdOut">Prompt</label>
              <textarea id="jdOut" readonly></textarea>
            </div>
            <div class="toolbar">
              <button id="jdGen" class="btn brand" type="button">Generate Prompt</button>
              <button id="jdCopy" class="btn" type="button">Copy</button>
            </div>
          </div>

          <div class="card">
            <div class="h2">Resume Improvement Suggestions</div>
            <div class="field">
              <label for="resumeText">Paste Resume Summary</label>
              <textarea id="resumeText" placeholder="Paste your resume summary here…"></textarea>
            </div>
            <div class="field">
              <label for="resumeSuggestions">Suggestions</label>
              <textarea id="resumeSuggestions" readonly></textarea>
            </div>
            <div class="toolbar">
              <button id="resumeAnalyze" class="btn brand" type="button">Analyze</button>
              <button id="resumeCopy" class="btn" type="button">Copy</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <div class="h2">Skill Match Analyzer</div>
          <div class="grid grid-2">
            <div class="field">
              <label for="jobDescIn">Job Description</label>
              <textarea id="jobDescIn" placeholder="Paste a job description…"></textarea>
            </div>
            <div class="field">
              <label for="resumeIn">Resume Summary</label>
              <textarea id="resumeIn" placeholder="Paste your resume summary…"></textarea>
            </div>
          </div>
          <div class="toolbar" style="margin-top:8px">
            <button id="scoreBtn" class="btn brand" type="button">Score Match</button>
            <div id="scoreOut" class="muted">Score: —</div>
          </div>
        </div>
      </section>

       eBooks 
      <section id="ebooks" aria-hidden="true">
        <div class="section-header">
          <div class="h1">eBooks & Guides</div>
          <div class="muted">Download helpful guides generated on the fly.</div>
        </div>

        <div class="grid grid-2">
          <div class="card reveal">
            <div class="h2">Interview Preparation</div>
            <p class="muted">Core questions, STAR method, and manufacturing roles tips.</p>
            <button class="btn accent" data-ebook="interview">Download</button>
          </div>
          <div class="card reveal">
            <div class="h2">Resume Template & Checklist</div>
            <p class="muted">Simple, scannable resume format with keyword tips.</p>
            <button class="btn accent" data-ebook="resume">Download</button>
          </div>
          <div class="card reveal">
            <div class="h2">Contractor Hiring Playbook</div>
            <p class="muted">Write better JDs, shortlist fast, communicate clearly.</p>
            <button class="btn accent" data-ebook="hiring">Download</button>
          </div>
          <div class="card reveal">
            <div class="h2">Job Portal Admin Guide</div>
            <p class="muted">Approvals, featured jobs, and platform hygiene.</p>
            <button class="btn accent" data-ebook="admin">Download</button>
          </div>
        </div>
      </section>
    </main>

    <footer role="contentinfo" class="container">
      <div>© <span id="year"></span> Job Portal. Contact: info@example.com · Phone: +91 90000 00000</div>
    </footer>

    <template id="jobCardTpl">
      <div class="card reveal">
        <div style="display:flex; justify-content: space-between; align-items: start; gap: 12px">
          <div>
            <div class="h2"></div>
            <div class="muted"></div>
          </div>
          <div class="chip type"></div>
        </div>
        <div class="muted" style="margin-top:6px"></div>
        <div class="skills" style="margin-top:8px"></div>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn brand apply">Apply</button>
          <button class="btn" data-action="whatsapp">WhatsApp</button>
          <button class="btn" data-action="email">Email</button>
          <button class="btn ghost" data-action="view">View</button>
        </div>
      </div>
    </template>

    <script>
      (() => {
        const $ = (s, el = document) => el.querySelector(s);
        const $$ = (s, el = document) => Array.from(el.querySelectorAll(s));
        const state = {
          role: localStorage.getItem('role') || 'guest',
          theme: localStorage.getItem('theme') || 'light',
          data: null,
          activeTab: 'dashboard',
          activeConv: null,
          notif: []
        };

        const nowYear = new Date().getFullYear();
        $('#year').textContent = nowYear;

        // Theme
        const applyTheme = () => {
          document.documentElement.setAttribute('data-theme', state.theme);
          $('#sun').style.display = state.theme === 'light' ? 'block' : 'none';
          $('#moon').style.display = state.theme === 'dark' ? 'block' : 'none';
        };
        applyTheme();
        $('#themeToggle').addEventListener('click', () => {
          state.theme = state.theme === 'light' ? 'dark' : 'light';
          localStorage.setItem('theme', state.theme);
          applyTheme();
        });

        // Role
        $('#roleSelect').value = state.role;
        $('#roleSelect').addEventListener('change', (e) => {
          state.role = e.target.value;
          localStorage.setItem('role', state.role);
          toast('Role set to ' + state.role);
          enforceRoleVisibility();
          renderAll();
        });

        // Tabs
        $$('.tab').forEach(btn => {
          btn.addEventListener('click', () => {
            setTab(btn.dataset.tab);
          });
        });
        function setTab(id) {
          state.activeTab = id;
          $$('main section').forEach(sec => {
            sec.setAttribute('aria-hidden', sec.id === id ? 'false' : 'true');
          });
          $$('.tab').forEach(t => t.setAttribute('aria-selected', t.dataset.tab === id ? 'true' : 'false'));
          if (id === 'jobs') renderJobs();
          if (id === 'apps') renderApplicantsAndApplied();
          if (id === 'messages') renderConversations();
          if (id === 'admin') renderAdmin();
          if (id === 'dashboard') renderDashboard();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Seed data
        function seed() {
          const seeded = {
            users: [
              { id: 'u1', type: 'contractor', name: 'Bhavani Industries', location: 'Chakan, Pune', contact: '+91 90000 10001' },
              { id: 'u2', type: 'seeker', name: 'Akash Kumar', contact: '+91 90000 20002', skills: ['ITI Fitter','Welding','Blueprint Reading'] },
              { id: 'u3', type: 'seeker', name: 'Priya Sharma', contact: '+91 90000 30003', skills: ['Design','AutoCAD'] },
              { id: 'u4', type: 'contractor', name: 'MechTech Pvt Ltd', location: 'Pimpri, Pune', contact: '+91 90000 40004' },
              { id: 'admin', type: 'admin', name: 'Site Admin' }
            ],
            jobs: [
              {
                id: 'j1', company: 'Bhavani Industries', location: 'Chakan, Pune',
                title: 'ITI Fitter', role: 'Fitter', type: 'Full-time', salary: 28000, count: 5,
                skills: ['MIG','TIG','Blueprint Reading'], desc: 'Assembly and fitting. Experience with jigs preferred.',
                facilities: ['Bus','Canteen'], expiry: futureDate(20), status: 'approved', featured: true
              },
              {
                id: 'j2', company: 'MechTech Pvt Ltd', location: 'Pimpri, Pune',
                title: 'Welder', role: 'Welder', type: 'Contract', salary: 24000, count: 3,
                skills: ['MIG','WPS'], desc: 'Structural welding for OEM parts.', facilities: ['Canteen'], expiry: futureDate(15), status: 'pending'
              },
              {
                id: 'j3', company: 'DesignForge', location: 'Hinjewadi, Pune',
                title: 'Junior Designer', role: 'Design', type: 'Internship', salary: 15000, count: 2,
                skills: ['AutoCAD','SolidWorks'], desc: 'Detail drawings, BOM updates.', facilities: ['Medical'], expiry: futureDate(30), status: 'approved'
              }
            ],
            applications: [
              { id: 'a1', jobId: 'j1', seeker: 'Akash Kumar', status: 'Applied', ts: Date.now() - 86400000 },
              { id: 'a2', jobId: 'j3', seeker: 'Priya Sharma', status: 'Interview', ts: Date.now() - 3600000 }
            ],
            messages: [
              { id: 'm1', partyA: 'Bhavani Industries', partyB: 'Akash Kumar', thread: [
                { from: 'Akash Kumar', text: 'Hello, I applied for ITI Fitter.', ts: Date.now()-7200000 },
                { from: 'Bhavani Industries', text: 'Thanks Akash, we will review.', ts: Date.now()-7100000 },
              ] }
            ],
            activity: [
              'Priya applied to Junior Designer',
              'Akash applied to ITI Fitter',
              'New job pending approval: Welder (MechTech)'
            ]
          };
          localStorage.setItem('jp_data', JSON.stringify(seeded));
          return seeded;
        }
        function load() {
          const raw = localStorage.getItem('jp_data');
          state.data = raw ? JSON.parse(raw) : seed();
        }
        function save() {
          localStorage.setItem('jp_data', JSON.stringify(state.data));
        }
        const futureDate = (days) => {
          const d = new Date(); d.setDate(d.getDate() + days); return d.toISOString().slice(0,10);
        };

        // Notifications
        function notify(msg) {
          state.notif.push({ id: 'n'+Math.random().toString(36).slice(2), text: msg, ts: Date.now() });
          $('#notifCount').textContent = state.notif.length;
          toast(msg);
        }
        function toast(text) {
          const t = document.createElement('div');
          t.textContent = text;
          t.style.position = 'fixed';
          t.style.left = '50%'; t.style.transform = 'translateX(-50%)';
          t.style.bottom = '20px'; t.style.background = 'var(--fg)';
          t.style.color = 'var(--bg)'; t.style.padding = '10px 14px';
          t.style.borderRadius = '999px'; t.style.boxShadow = 'var(--shadow-md)';
          t.style.zIndex = '100'; t.style.fontWeight = '700';
          document.body.appendChild(t);
          setTimeout(() => t.remove(), 2200);
        }
        $('#notifBtn').addEventListener('click', () => {
          if (state.notif.length === 0) { toast('No notifications'); return; }
          alert(state.notif.map(n => '• ' + n.text).join('\n'));
          state.notif = [];
          $('#notifCount').textContent = '0';
        });

        // Search filters
        const filters = {
          q: '', loc: '', type: '', salary: ''
        };
        const readFilters = () => {
          filters.q = $('#q').value.trim().toLowerCase();
          filters.loc = $('#loc').value.trim().toLowerCase();
          filters.type = $('#type').value;
          filters.salary = $('#salary').value;
        };
        $('#searchBtn').addEventListener('click', () => { readFilters(); renderJobs(); setTab('jobs'); });
        $('#clearFiltersBtn')?.addEventListener('click', () => {
          $('#q').value = ''; $('#loc').value = ''; $('#type').value = ''; $('#salary').value = '';
          readFilters(); renderJobs();
        });

        // Role-based visibility
        function enforceRoleVisibility() {
          const isContractor = state.role === 'contractor' || state.role === 'admin';
          const isSeeker = state.role === 'seeker' || state.role === 'admin';
          // Post tab only for contractors/admin
          $('[data-tab="post"]').style.display = isContractor ? '' : 'none';
          // Admin tab only for admin
          $('[data-tab="admin"]').style.display = state.role === 'admin' ? '' : 'none';
        }

        // Renderers
        function renderDashboard() {
          const jobs = state.data.jobs.filter(j => j.status === 'approved' && !expired(j.expiry));
          $('#kpiJobs').textContent = jobs.length;
          $('#kpiApps').textContent = state.data.applications.length;
          $('#kpiMsgs').textContent = state.data.messages.reduce((a,m) => a + m.thread.length, 0);

          // Slider
          const slides = $('#slides');
          slides.innerHTML = '';
          const highlights = jobs.slice(0,5);
          if (highlights.length === 0) {
            slides.innerHTML = `<div class="slide"><div class="dot"></div><div>No active highlights.</div></div>`;
          } else {
            highlights.forEach(j => {
              const d = document.createElement('div');
              d.className = 'slide';
              d.innerHTML = `<div class="dot"></div><div><strong>${j.title}</strong> at ${j.company} — ${j.location} · <span class="chip">${j.type}</span></div>`;
              slides.appendChild(d);
            });
          }
          startSlider();

          // Featured companies
          const feat = state.data.jobs.filter(j => j.featured).map(j => j.company);
          const unique = [...new Set(feat)];
          $('#featuredCompanies').textContent = unique.length ? unique.join(', ') : 'No featured companies yet.';

          // Activity
          $('#activity').innerHTML = state.data.activity.map(a => `• ${a}`).join('<br/>');

          reveal();
        }
        let sliderIdx = 0, sliderTimer;
        function startSlider() {
          clearInterval(sliderTimer);
          const el = $('#slides');
          const count = el.children.length;
          if (count <= 1) return;
          sliderIdx = 0;
          sliderTimer = setInterval(() => {
            sliderIdx = (sliderIdx + 1) % count;
            el.style.transform = `translateX(-${sliderIdx * 100}%)`;
          }, 3000);
        }

        function expired(dateStr) {
          if (!dateStr) return false;
          return new Date(dateStr).getTime() < Date.now();
        }

        function renderJobs() {
          const list = $('#jobList');
          list.innerHTML = '';
          let jobs = state.data.jobs.filter(j => j.status === 'approved' && !expired(j.expiry));
          // Filter
          jobs = jobs.filter(j => {
            const hitQ = !filters.q || (j.title + ' ' + j.role + ' ' + j.skills.join(' ')).toLowerCase().includes(filters.q);
            const hitL = !filters.loc || (j.location || '').toLowerCase().includes(filters.loc);
            const hitT = !filters.type || j.type === filters.type;
            const hitS = !filters.salary || salaryInRange(j.salary, filters.salary);
            return hitQ && hitL && hitT && hitS;
          });
          if (jobs.length === 0) {
            list.innerHTML = `<div class="muted">No jobs match your filters.</div>`;
            return;
          }
          jobs.forEach(j => list.appendChild(makeJobCard(j)));
          reveal();
        }
        function salaryInRange(s, bucket) {
          if (!bucket || s == null) return true;
          if (bucket.includes('+')) return s >= parseInt(bucket);
          const [a,b] = bucket.split('-').map(Number);
          return s >= a && s <= b;
        }
        function makeJobCard(job) {
          const tpl = $('#jobCardTpl');
          const node = tpl.content.firstElementChild.cloneNode(true);
          const [h2, muted1] = node.querySelectorAll('.h2, .muted');
          h2.textContent = `${job.title} — ${job.company}`;
          muted1.textContent = `${job.location} · ₹${job.salary?.toLocaleString?.('en-IN') || 'N/A'} · Positions: ${job.count}`;
          node.querySelector('.type').textContent = job.type;
          const skills = node.querySelector('.skills');
          job.skills.forEach(s => {
            const c = document.createElement('span');
            c.className = 'chip'; c.textContent = s; skills.appendChild(c);
          });
          node.querySelector('.apply').addEventListener('click', () => applyToJob(job));
          node.querySelector('[data-action="whatsapp"]').addEventListener('click', () => openWA(job));
          node.querySelector('[data-action="email"]').addEventListener('click', () => openEmail(job));
          node.querySelector('[data-action="view"]').addEventListener('click', () => viewJob(job));
          return node;
        }
        function applyToJob(job) {
          if (state.role !== 'seeker' && state.role !== 'admin') { toast('Switch role to Job Seeker to apply'); return; }
          const name = state.data.users.find(u => u.type === 'seeker')?.name || 'Guest Seeker';
          const has = state.data.applications.some(a => a.jobId === job.id && a.seeker === name);
          if (has) { toast('Already applied'); return; }
          state.data.applications.push({ id: 'a'+Math.random().toString(36).slice(2), jobId: job.id, seeker: name, status: 'Applied', ts: Date.now() });
          state.data.activity.unshift(`${name} applied to ${job.title}`);
          save();
          notify('New application for ' + job.title);
          renderApplicantsAndApplied();
        }
        function openWA(job) {
          const text = encodeURIComponent(`Hello, I'm interested in the ${job.title} at ${job.company}.`);
          window.open(`https://wa.me/919000000000?text=${text}`, '_blank');
        }
        function openEmail(job) {
          const subject = encodeURIComponent(`Application: ${job.title} — ${job.company}`);
          const body = encodeURIComponent(`Hello,\n\nI'm interested in the ${job.title} role.\n\nThanks.`);
          window.location.href = `mailto:hr@example.com?subject=${subject}&body=${body}`;
        }
        function viewJob(job) {
          alert(`${job.title} at ${job.company}\n\n${job.desc}\n\nSkills: ${job.skills.join(', ')}`);
        }

        // Post job
        $('#postForm').addEventListener('submit', (e) => {
          e.preventDefault();
          if (state.role !== 'contractor' && state.role !== 'admin') { toast('Switch role to Contractor to post'); return; }
          const job = {
            id: 'j'+Math.random().toString(36).slice(2),
            company: $('#company').value.trim(),
            location: $('#location').value.trim(),
            title: $('#title').value.trim(),
            role: $('#role').value.trim(),
            type: $('#typeSel').value,
            salary: parseInt($('#salaryIn').value || '0'),
            count: parseInt($('#count').value || '1'),
            skills: ($('#skills').value || '').split(',').map(s => s.trim()).filter(Boolean),
            desc: $('#desc').value.trim(),
            facilities: $$('#postForm input[type="checkbox"]:checked').map(c => c.value),
            expiry: $('#expiry').value || futureDate(30),
            status: 'pending',
            featured: false
          };
          state.data.jobs.push(job);
          state.data.activity.unshift(`New job pending approval: ${job.title} (${job.company})`);
          save();
          notify('Job submitted for approval');
          e.target.reset();
          setTab('admin');
          renderAdmin();
        });

        // Applicants / Applied
        function renderApplicantsAndApplied() {
          const appByJob = state.data.jobs.map(j => ({
            job: j, apps: state.data.applications.filter(a => a.jobId === j.id)
          })).filter(x => x.apps.length > 0);

          const AL = $('#applicantsList');
          if (appByJob.length === 0) {
            AL.textContent = 'No applicants yet.'; 
          } else {
            AL.innerHTML = '';
            appByJob.forEach(({job, apps}) => {
              const block = document.createElement('div');
              block.style.borderTop = '1px solid rgba(2,6,23,.08)';
              block.style.padding = '10px 0';
              block.innerHTML = `<strong>${job.title} — ${job.company}</strong>`;
              apps.forEach(a => {
                const row = document.createElement('div');
                row.style.display = 'flex'; row.style.gap = '8px'; row.style.alignItems = 'center';
                row.style.marginTop = '6px';
                row.innerHTML = `
                  <span class="chip">${a.seeker}</span>
                  <span class="chip">${a.status}</span>
                  <button class="btn" data-st="Interview">Interview</button>
                  <button class="btn" data-st="Selected">Select</button>
                  <button class="btn ghost" data-st="Rejected">Reject</button>
                `;
                $$( '[data-st]', row ).forEach(btn => {
                  btn.addEventListener('click', () => {
                    a.status = btn.getAttribute('data-st');
                    state.data.activity.unshift(`Status for ${a.seeker} on ${job.title}: ${a.status}`);
                    save();
                    notify(`Application status: ${a.status}`);
                    renderApplicantsAndApplied();
                  });
                });
                block.appendChild(row);
              });
              AL.appendChild(block);
            });
          }

          const name = state.data.users.find(u => u.type === 'seeker')?.name || 'Akash Kumar';
          const myApps = state.data.applications.filter(a => a.seeker === name);
          const AP = $('#appliedList');
          if (myApps.length === 0) {
            AP.textContent = 'No applications yet.';
          } else {
            AP.innerHTML = myApps.map(a => {
              const j = state.data.jobs.find(j => j.id === a.jobId);
              return `<div style="border-top:1px solid rgba(2,6,23,.08); padding:8px 0">
                <strong>${j?.title || a.jobId}</strong> — ${j?.company || ''} · <span class="chip">${a.status}</span>
              </div>`;
            }).join('');
          }
        }

        // Messages
        function renderConversations() {
          const C = $('#conversations');
          const threads = state.data.messages;
          if (threads.length === 0) { C.textContent = 'No conversations yet.'; return; }
          C.innerHTML = '';
          threads.forEach(t => {
            const btn = document.createElement('button');
            btn.className = 'btn full';
            btn.textContent = `${t.partyA} ↔ ${t.partyB}`;
            btn.addEventListener('click', () => { state.activeConv = t.id; renderThread(); });
            C.appendChild(btn);
          });
          if (!state.activeConv && threads[0]) { state.activeConv = threads[0].id; }
          renderThread();
        }
        function renderThread() {
          const T = $('#thread');
          const conv = state.data.messages.find(m => m.id === state.activeConv);
          if (!conv) { T.textContent = 'Select a conversation.'; return; }
          T.innerHTML = conv.thread.map(x => `<div style="margin:6px 0"><strong>${x.from}:</strong> ${x.text}</div>`).join('');
        }
        $('#msgForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const text = $('#msgText').value.trim();
          if (!text) return;
          const conv = state.data.messages.find(m => m.id === state.activeConv) || state.data.messages[0];
          if (!conv) { toast('No conversation selected'); return; }
          const from = state.role === 'contractor' ? conv.partyA : 'You';
          conv.thread.push({ from, text, ts: Date.now() });
          save();
          $('#msgText').value = '';
          notify('New message sent');
          renderThread();
        });
        $('#shareContactBtn').addEventListener('click', () => {
          const details = 'Phone: +91 90000 00000 · WhatsApp: +91 90000 00000';
          $('#msgText').value = `My contact details — ${details}`;
        });

        // Admin
        function renderAdmin() {
          const PJ = $('#pendingJobs');
          const pending = state.data.jobs.filter(j => j.status === 'pending');
          if (pending.length === 0) { PJ.textContent = 'No pending vacancies.'; }
          else {
            PJ.innerHTML = '';
            pending.forEach(j => {
              const row = document.createElement('div');
              row.style.borderTop = '1px solid rgba(2,6,23,.08)'; row.style.padding = '8px 0';
              row.innerHTML = `
                <div><strong>${j.title}</strong> — ${j.company} · ${j.location}</div>
                <div class="toolbar" style="margin-top:6px">
                  <button class="btn brand" data-act="approve">Approve</button>
                  <button class="btn" data-act="feature">Feature</button>
                  <button class="btn ghost" data-act="reject">Reject</button>
                </div>
              `;
              $('[data-act="approve"]', row).addEventListener('click', () => {
                j.status = 'approved'; save(); notify('Job approved'); renderAdmin(); renderJobs(); renderDashboard();
              });
              $('[data-act="feature"]', row).addEventListener('click', () => {
                j.featured = !j.featured; save(); notify(j.featured ? 'Featured' : 'Unfeatured'); renderDashboard();
              });
              $('[data-act="reject"]', row).addEventListener('click', () => {
                state.data.jobs = state.data.jobs.filter(x => x.id !== j.id); save(); notify('Job rejected'); renderAdmin(); renderJobs(); renderDashboard();
              });
              PJ.appendChild(row);
            });
          }

          const UL = $('#usersList');
          UL.innerHTML = state.data.users.map(u => {
            return `<div style="border-top:1px solid rgba(2,6,23,.08); padding:8px 0">
              <strong>${u.name}</strong> — ${u.type}${u.location ? ' · ' + u.location : ''}
            </div>`;
          }).join('');
        }

        // AI Tools – simple local logic
        $('#jdGen').addEventListener('click', () => {
          const title = $('#jdTitle').value.trim() || 'Role';
          const skills = ($('#jdSkills').value || '').split(',').map(s => s.trim()).filter(Boolean);
          const prompt = [
            `Write a clear, scannable Job Description for "${title}".`,
            `Include: Summary (3-4 lines), Responsibilities (5-7 bullets), Required Skills (${skills.join(', ') || 'role-specific skills'}), Qualifications, Salary Range, Facilities (Bus/Canteen/Medical), and How to Apply.`,
            `Keep tone concise and use action verbs.`
          ].join('\n');
          $('#jdOut').value = prompt;
        });
        $('#jdCopy').addEventListener('click', () => copyText('#jdOut'));

        $('#resumeAnalyze').addEventListener('click', () => {
          const text = $('#resumeText').value.toLowerCase();
          const tips = [];
          if (!/achiev|improv|reduce|increase|save|led/.test(text)) tips.push('Add 3-5 quantified achievements (numbers, % impact).');
          if (text.length < 300) tips.push('Expand summary to 4-6 lines with core skills and domains.');
          if (!/mig|tig|autocad|solidworks|blueprint/.test(text)) tips.push('Include tool keywords relevant to target roles (e.g., MIG, TIG, AutoCAD, SolidWorks).');
          tips.push('Keep formatting simple: 1-page, clear headings, consistent bullets.');
          $('#resumeSuggestions').value = tips.map(t => '• ' + t).join('\n');
        });
        $('#resumeCopy').addEventListener('click', () => copyText('#resumeSuggestions'));

        $('#scoreBtn').addEventListener('click', () => {
          const jd = $('#jobDescIn').value.toLowerCase();
          const rs = $('#resumeIn').value.toLowerCase();
          const jdKeys = extractKeywords(jd);
          const rsKeys = extractKeywords(rs);
          const hits = jdKeys.filter(k => rsKeys.includes(k));
          const score = jdKeys.length ? Math.round((hits.length / jdKeys.length) * 100) : 0;
          $('#scoreOut').textContent = `Score: ${score} (${hits.slice(0,10).join(', ')})`;
        });
        function extractKeywords(text) {
          return Array.from(new Set(text.split(/[^a-z0-9+]+/g).filter(w => w.length > 2)))
            .filter(w => !['and','the','for','with','this','that','your','from','you','are','job','role','work','will','have','has'].includes(w));
        }
        function copyText(sel) {
          const el = $(sel);
          el.select(); document.execCommand('copy');
          toast('Copied to clipboard');
        }

        // eBooks: generate files on the fly
        $$('#ebooks .btn.accent').forEach(btn => {
          btn.addEventListener('click', () => {
            const kind = btn.getAttribute('data-ebook');
            const map = {
              interview: {
                name: 'interview-prep.txt',
                data: [
                  '# Interview Preparation',
                  '- Use STAR: Situation, Task, Action, Result.',
                  '- Prepare 5 stories: quality, teamwork, leadership, failure, constraint.',
                  '- For manufacturing: safety, quality checks, blueprint reading, 5S.'
                ].join('\n')
              },
              resume: {
                name: 'resume-template.txt',
                data: [
                  '# Resume Template',
                  'Name | Phone | Email | Location',
                  'Summary: 3-4 lines with role + key skills.',
                  'Experience: 3-4 bullets per role with numbers.',
                  'Skills: tools + certifications keywords.',
                ].join('\n')
              },
              hiring: {
                name: 'contractor-hiring-playbook.txt',
                data: [
                  '# Hiring Playbook',
                  '1) Crisp JD, 2) 24h shortlist, 3) Standard message templates, 4) Feedback loop.',
                ].join('\n')
              },
              admin: {
                name: 'admin-guide.txt',
                data: [
                  '# Admin Guide',
                  'Approve pending, feature quality jobs, prune expired postings weekly.',
                ].join('\n')
              }
            };
            const pick = map[kind];
            const blob = new Blob([pick.data], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = pick.name; a.click();
            URL.revokeObjectURL(url);
          });
        });

        // Intersection reveal
        function reveal() {
          const io = new IntersectionObserver((entries) => {
            entries.forEach(e => {
              if (e.isIntersecting) {
                e.target.classList.add('in');
                io.unobserve(e.target);
              }
            });
          }, { threshold: .1 });
          $$('.reveal').forEach(el => io.observe(el));
        }

        // Seed/reset
        $('#seedBtn').addEventListener('click', () => {
          seed(); load(); renderAll(); notify('Data reset');
        });

        // Init
        load();
        enforceRoleVisibility();
        renderAll();
        function renderAll() {
          renderDashboard(); renderJobs(); renderApplicantsAndApplied(); renderConversations(); renderAdmin();
          $('#notifCount').textContent = state.notif.length;
        }
      })();
    </script>

    <script>
      (function roleGuardAndNav() {
        try {
          var AUTH_KEY = "MEECHTO_AUTH";
          var raw = localStorage.getItem(AUTH_KEY);
          var user = raw ? JSON.parse(raw) : null;

          // If HR visits index, send to HR dashboard (prevents HR seeing seeker UI)
          if (user && user.role === "hr") {
            if (!location.pathname.endsWith("hr.html")) {
              location.href = "hr.html";
              return;
            }
          }

          // Toggle nav items
          var loginLink = document.getElementById("loginLink");
          var registerLink = document.getElementById("registerLink");
          var logoutBtn = document.getElementById("logoutBtn");

          if (user) {
            if (loginLink) loginLink.style.display = "none";
            if (registerLink) registerLink.style.display = "none";
            if (logoutBtn) {
              logoutBtn.style.display = "inline-flex";
              logoutBtn.addEventListener("click", function () {
                localStorage.removeItem(AUTH_KEY);
                location.reload();
              });
            }
          }
        } catch (e) {
          console.warn("[Meechto] role/nav init failed:", e);
        }
      })();
    </script>
  </body>
</html>
